<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema A.D.E.M. 游깵</title>

    <!-- Bootstrap CSS --><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Recharts (for prediction charts) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/recharts.min.js"></script>

    <style>
        :root {
            --color-bg-dark: #2C3E50; /* Background */
            --color-card-dark: #34495E; /* Card Background */
            --color-nav-dark: #233140; /* Navbar/Footer */
            
            --color-text-light: #ECF0F1; /* Main text */
            --color-text-muted: #BDC3C7; /* Muted text */

            --color-primary-blue: #3498DB; /* Main color */
            --color-accent-green: #16A085; /* Accent color */

            --color-alert-red: #FF7043;
            
            --font-main: 'Montserrat', sans-serif;
            --font-data: 'Inconsolata', monospace;
        }

        body {
            background: none;
            font-family: var(--font-main);
            color: var(--color-text-light);
            min-height: 100vh;
            position: relative;
            margin: 0;
            padding: 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(44, 62, 80, 0.75);
            z-index: -2;
            pointer-events: none;
        }

        /* --- INICIO DE LOS CAMBIOS --- */
        /* Contenedor del video de fondo */
        .bg-video-container {
            position: fixed; /* Fija el contenedor a la pantalla */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3; /* Env칤a el fondo al final */
            overflow: hidden; /* Oculta cualquier parte del video que se salga */
        }

        /* El video de fondo en s칤 */
        .bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* <-- 춰ESTA ES LA PROPIEDAD CLAVE! */
        }
        /* --- FIN DE LOS CAMBIOS --- */

        h2, h3, h4, h5, h6 {
            font-family: var(--font-main);
            font-weight: bold;
            color: var(--color-text-light);
        }

        h1{
            font-family: var(--font-main);
            font-weight: bold;
            color: var(--color-text-light);
        }
        
        .navbar-custom {
            background-color: var(--color-nav-dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .header-bg {
            background: url('images/clouds_by_CHUTTERSNAP_unsplash.avif') no-repeat center center/cover;
            background-position: center bottom;
            padding: 3rem 0;
            color: var(--color-text-light);
            margin-bottom: 2rem;
            position: relative;
            text-align: center;
            overflow: hidden;
        }

        .header-video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            z-index: -1;
            object-fit: cover;
        }

        .header-bg-overlay {
            position: relative;
            z-index: 1;
        }
        
        .header-text-container {
            background-color: rgba(35, 49, 64, 0.85);
            padding: 0.8rem 1.5rem;
            border-radius: 0.5rem;
            display: inline-block;
            backdrop-filter: blur(5px);
        }

        .header-bg h1 {
            color: var(--color-primary-blue) !important; 
            text-shadow: none;
            font-size: 2rem;
            margin-bottom: 0.3rem;
        }
        .header-bg p {
            color: var(--color-text-light) !important;
            text-shadow: none;
            font-size: 0.95rem;
            margin-bottom: 0;
        }

        .metric-card {
            background-color: var(--color-card-dark);
            border: 1px solid var(--color-primary-blue);
            border-radius: 0.75rem;
        }

        .highlight-data {
            font-family: var(--font-data);
            color: var(--color-accent-green);
            font-size: 2.5rem; 
            font-weight: 700;
            line-height: 1;
        }
        
        .highlight-data-small {
            font-family: var(--font-data);
            color: var(--color-accent-green);
            font-size: 1.5rem;
            font-weight: 700;
            white-space: nowrap;
        }
        
        .text-muted-custom {
            color: var(--color-text-muted) !important;
        }

        .btn-custom-primary {
            background-color: var(--color-primary-blue);
            color: var(--color-text-light);
            border: 2px solid var(--color-primary-blue);
            transition: background-color 0.3s, border-color 0.3s, transform 0.1s;
            font-weight: 600;
        }

        .btn-custom-primary:hover {
            background-color: var(--color-accent-green);
            border-color: var(--color-accent-green);
            transform: scale(1.05);
            color: var(--color-text-light);
        }

        .btn-custom-secondary {
            background-color: var(--color-accent-green);
            color: var(--color-text-light);
            border: 2px solid var(--color-accent-green);
            transition: background-color 0.3s, border-color 0.3s, transform 0.1s;
            font-weight: 600;
        }

        .btn-custom-secondary:hover {
            background-color: var(--color-primary-blue);
            border-color: var(--color-primary-blue);
            transform: scale(1.05);
            color: var(--color-text-light);
        }

        /* Nav links */
        .nav-link-custom {
            color: var(--color-text-light) !important;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-link-custom:hover {
            color: var(--color-accent-green) !important;
        }

        /* Image for "Learn More" cards */
        .card-img-top-small {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 0.75rem 0.75rem 0 0;
            opacity: 0.85;
        }

        /* Prediction Chart Styles */
        .prediction-section {
            margin-top: 3rem;
            padding: 2rem;
            background-color: rgba(52, 73, 94, 0.5);
            border-radius: 0.75rem;
            border-left: 4px solid var(--color-accent-green);
            max-width: 100%;
        }

        .chart-container {
            background-color: var(--color-card-dark);
            border: 1px solid var(--color-primary-blue);
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 1.5rem;
        }

        .prediction-info {
            background-color: rgba(22, 160, 133, 0.1);
            border-left: 4px solid var(--color-accent-green);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .prediction-info i {
            color: var(--color-accent-green);
            margin-right: 0.5rem;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .comparison-card {
            background-color: var(--color-card-dark);
            border: 1px solid var(--color-primary-blue);
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
        }

        .comparison-label {
            color: var(--color-text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .comparison-value {
            font-family: var(--font-data);
            color: var(--color-accent-green);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .comparison-change {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .change-positive {
            color: var(--color-alert-red);
        }

        .change-negative {
            color: var(--color-accent-green);
        }

        svg {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

    </style>
</head>
<body>

    <!-- Background Video Container -->
    <div class="bg-video-container">
        <!-- Aseg칰rate de que la ruta 'videos/clouds.mp4' sea correcta -->
        <video class="bg-video" autoplay muted loop>
            <source src="videos/headervid.mp4" type="video/mp4">
            Tu navegador no soporta videos HTML5.
        </video>
    </div>

    <!-- 1. Navigation Bar --><nav class="navbar navbar-expand-lg navbar-dark navbar-custom py-3 sticky-top">
        <div class="container-fluid container-lg">
            <a class="navbar-brand text-uppercase" href="#" style="color: var(--color-primary-blue); font-weight: 700;">
                <i class="bi bi-globe-americas me-2"></i>SISTEMA A.D.E.M.
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link nav-link-custom active" aria-current="page" href="index.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-custom" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 2. Header Section with Background Image --><header class="header-bg">
        <!-- Video de fondo del header -->
        <video class="header-video" autoplay muted loop>
            <source src="videos/headervid.mp4" type="video/mp4">
            Tu navegador no soporta videos HTML5
        </video>

        <div class="container-fluid container-lg header-bg-overlay">
            <div class="header-text-container mx-auto">
                <h1 class="display-5">Sistema A.D.E.M.</h1>
                <p class="lead">Sistema de An치lisis y Diagn칩stico del Entorno Medioambiental</p>
            </div>
        </div>
    </header>

    <div class="container-fluid container-lg pt-2 pb-5">
        
        <!-- 3. Five-Column Div (Current Status, Humidity, Local & Global Prediction) -->
        <h2 class="h4 text-center mb-4 text-uppercase" style="color: var(--color-text-light);">Datos Actuales (Raspberry Pi)</h2>
        
        <!-- Row 1: Current Global Metrics (3 columns) -->
        <div class="row g-4 mb-4">
            
            <!-- Column 1: Current Temperature (Global) -->
            <div class="col-md-4">
                <div class="p-4 metric-card text-center">
                    <i class="bi bi-thermometer-high fs-2 mb-3" style="color: var(--color-primary-blue);"></i>
                    <h3 class="h5 mb-3">Temperatura</h3>
                    
                    <div class="highlight-data mb-3">
                        <span id="current-temp" style="color: var(--color-accent-green);">??춿C</span>
                    </div>
                    
                    <p class="small text-muted-custom mb-0">
                        <i class="bi bi-cpu me-1" style="color: var(--color-accent-green);"></i> Datos del sensor Raspberry Pi
                    </p>
                </div>
            </div>

            <!-- Column 2: Current CO2 Levels (Global) -->
            <div class="col-md-4">
                <div class="p-4 metric-card text-center">
                    <i class="bi bi-cloud-haze2 fs-2 mb-3" style="color: var(--color-primary-blue);"></i>
                    <h3 class="h5 mb-3">Nivel de CO2</h3>
                    
                    <div class="highlight-data mb-3">
                        <span id="current-co2" style="color: var(--color-accent-green);">?? ppm</span>
                    </div>
                    
                    <p class="small text-muted-custom mb-0">
                        <i class="bi bi-cpu me-1" style="color: var(--color-accent-green);"></i> Datos del sensor Raspberry Pi
                    </p>
                </div>
            </div>

            <!-- Column 3: Current Humidity Levels (Global) -->
            <div class="col-md-4">
                <div class="p-4 metric-card text-center">
                    <i class="bi bi-water fs-2 mb-3" style="color: var(--color-primary-blue);"></i>
                    <h3 class="h5 mb-3">Humedad</h3>
                    
                    <div class="highlight-data mb-3">
                        <span id="current-humidity" style="color: var(--color-accent-green);">??%</span>
                    </div>
                    
                    <p class="small text-muted-custom mb-0">
                        <i class="bi bi-cpu me-1" style="color: var(--color-accent-green);"></i> Datos del sensor Raspberry Pi
                    </p>
                </div>
            </div>

        </div>

        <!-- Row 2: Local & Prediction Metrics (2 columns) -->
        <div class="row g-4 mb-5 justify-content-center">
            
            <!-- Column 4: Current Local City Data (Internet Source) -->
            <div class="col-md-6">
                <div class="p-4 metric-card text-center h-100">
                    <i class="bi bi-cloud-sun fs-2 mb-3" style="color: var(--color-primary-blue);"></i>
                    <h3 class="h5 mb-3"><span id="city-title">Zapopan, Jalisco, Mexico</span></h3> 
                    
                    <div class="row justify-content-center">
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Temperatura</h4>
                            <div class="highlight-data-small mb-3"><span id="local-temp">Cargando...</span></div>
                        </div>
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Nivel CO2</h4>
                            <div class="highlight-data-small mb-3"><span id="local-co2">Cargando...</span></div>
                        </div>
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Humedad</h4>
                            <div class="highlight-data-small mb-3"><span id="local-humidity">Cargando...</span></div>
                        </div>
                    </div>
                    
                    <p class="small text-muted-custom mb-0 mt-3">
                        <i class="bi bi-cloud-sun me-1" style="color: var(--color-primary-blue);"></i> Data from Open-Meteo API
                    </p>
                </div>
            </div>

            <!-- Column 5: Future Global Prediction (RPi/Flask Source) -->
            <div class="col-md-6">
                <div class="p-4 metric-card text-center h-100">
                    <i class="bi bi-graph-up-arrow fs-2 mb-3" style="color: var(--color-primary-blue);"></i>
                    <h3 class="h5 mb-3">Predicciones (24h)</h3>
                    
                    <div class="row justify-content-center">
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Temperatura</h4>
                            <div class="highlight-data-small mb-3"><span id="pred-temp">+??춿C</span></div>
                        </div>
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Nivel CO2</h4>
                            <div class="highlight-data-small mb-3"><span id="pred-co2">?? ppm</span></div>
                        </div>
                        <div class="col-4">
                            <h4 class="small text-muted-custom">Humedad</h4>
                            <div class="highlight-data-small mb-3"><span id="pred-humidity">??%</span></div>
                        </div>
                    </div>
                    
                    <p class="small text-muted-custom mb-0 mt-3">
                        <i class="bi bi-speedometer2 me-1" style="color: var(--color-primary-blue);"></i> Basado en tendencias hist칩ricas
                    </p>
                </div>
            </div>

        </div>

        <!-- PREDICTION SECTION WITH CHART -->
        <section class="prediction-section">
            <h2 class="h4 text-center mb-4 text-uppercase" style="color: var(--color-text-light);">
                <i class="bi bi-graph-up me-2" style="color: var(--color-accent-green);"></i>Modelo Predictivo de CO2
            </h2>

            <div class="prediction-info">
                <i class="bi bi-info-circle"></i>
                <strong>Informaci칩n:</strong> Este modelo predice la concentraci칩n de CO2 para los pr칩ximos 7 d칤as bas치ndose en datos hist칩ricos del sensor Raspberry Pi y comparaciones con datos externos de Open-Meteo.
            </div>

            <!-- Comparison Cards -->
            <h5 class="mb-3" style="color: var(--color-primary-blue);">Comparativa Actual vs Predicci칩n (7 d칤as)</h5>
            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="comparison-label">CO2 Actual</div>
                    <div class="comparison-value" id="comp-current-co2">425 ppm</div>
                    <div class="comparison-change">Sensor RPi</div>
                </div>
                <div class="comparison-card">
                    <div class="comparison-label">CO2 Predicho (7d)</div>
                    <div class="comparison-value" id="comp-pred-co2">438 ppm</div>
                    <div class="comparison-change change-positive">
                        <i class="bi bi-arrow-up"></i> +13 ppm
                    </div>
                </div>
                <div class="comparison-card">
                    <div class="comparison-label">Tasa de Cambio</div>
                    <div class="comparison-value" id="comp-rate">+1.86 ppm/d칤a</div>
                    <div class="comparison-change">Promedio</div>
                </div>
                <div class="comparison-card">
                    <div class="comparison-label">Confianza del Modelo</div>
                    <div class="comparison-value" id="comp-confidence">92%</div>
                    <div class="comparison-change change-negative">
                        <i class="bi bi-graph-up-arrow"></i> Altamente confiable
                    </div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <h5 class="mb-3" style="color: var(--color-primary-blue);">Proyecci칩n de CO2 (ppm)</h5>
                <canvas id="co2-prediction-chart" style="max-height: 400px;"></canvas>
            </div>
        </section>

        <!-- 4. Two-Column Div (Actions/Navigation) -->
        <h2 class="h4 text-center mb-4 mt-5 text-uppercase" style="color: var(--color-text-light);">Learn More</h2>
        <div class="row g-4 justify-content-center">
            
            <!-- Column 1: Project Details (Local Redirect) -->
            <div class="col-md-6">
                <div class="card p-0 metric-card h-100 border-0">
                    <img src="images/data_modeling.jpg" class="card-img-top-small" alt="Placeholder image showing a blue and white data model representation." onerror="this.src='https://placehold.co/600x150/3498DB/ECF0F1?text=Data+Modeling'">
                    <div class="card-body p-4">
                        <h4 style="color: var(--color-primary-blue); font-weight: 700;">About the TerraPredict Project</h4>
                        <p class="text-muted-custom small">TerraPredict aims to provide accessible, real-time climate data powered by embedded systems (like Raspberry Pi) and sophisticated forecasting models. Learn about our methodology and data sources.</p>
                        <a href="about.html" class="btn btn-custom-primary mt-2">
                            <i class="bi bi-info-circle me-2"></i>Project Details
                        </a>
                    </div>
                </div>
            </div>

            <!-- Column 2: External Initiative (External Redirect) -->
            <div class="col-md-6">
                <div class="card p-0 metric-card h-100 border-0">
                    <img src="images/sustainable_initiative.jpg" class="card-img-top-small" alt="Placeholder image showing a green and white sustainable initiative graphic." onerror="this.src='https://placehold.co/600x150/16A085/ECF0F1?text=Sustainable+Initiative'">
                    <div class="card-body p-4">
                        <h4 style="color: var(--color-primary-blue); font-weight: 700;">Global Sustainability Initiative</h4>
                        <p class="text-muted-custom small">Discover a leading global initiative dedicated to climate remediation and carbon reduction policies across key industrial sectors. Find out how you can contribute to global climate goals.</p>
                        <a href="https://global-initiative.org" target="_blank" class="btn btn-custom-secondary mt-2">
                            <i class="bi bi-arrow-up-right-square me-2"></i>Visit Initiative Website
                        </a>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- 5. Footer --><footer class="mt-5 py-4 navbar-custom text-white">
        <div class="container-fluid container-lg text-center">
            <p class="mb-0 small" style="color: var(--color-text-light);">
                &copy; 2025 TerraPredict | Climate Monitoring Project.
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle --><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Chart.js for predictions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>

        // ============================================================================
        // SENSOR DATA FROM RASPBERRY PI (STATIC FOR NOW - REPLACE WITH DB LATER)
        // ============================================================================
        
        const sensorData = {
            temperature: 22.5,    // 춿C
            humidity: 58.3,       // %
            co2: 425              // ppm
        };

        // Historical sensor data for trend analysis (7 days)
        const historicalCO2Data = [
            { date: 'D칤a -6', value: 410 },
            { date: 'D칤a -5', value: 415 },
            { date: 'D칤a -4', value: 418 },
            { date: 'D칤a -3', value: 421 },
            { date: 'D칤a -2', value: 423 },
            { date: 'D칤a -1', value: 424 },
            { date: 'Hoy', value: 425 },
        ];

        // ============================================================================
        // PREDICTIVE MODEL FOR CO2
        // ============================================================================

        /**
         * Calculates CO2 predictions using linear regression on historical data
         * @returns {Object} Prediction data with trend, rate, and forecast
         */
        function calculateCO2Predictions() {
            const n = historicalCO2Data.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

            // Linear regression calculation
            for (let i = 0; i < n; i++) {
                const x = i;
                const y = historicalCO2Data[i].value;
                sumX += x;
                sumY += y;
                sumXY += x * y;
                sumX2 += x * x;
            }

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            // Generate 7-day forecast
            const forecast = [];
            const currentCO2 = historicalCO2Data[n - 1].value;

            for (let i = 1; i <= 7; i++) {
                const predictedValue = intercept + slope * (n - 1 + i);
                forecast.push({
                    date: `+${i}d`,
                    value: Math.round(predictedValue * 10) / 10
                });
            }

            // Calculate metrics
            const predictionIn7Days = forecast[6].value;
            const totalChange = predictionIn7Days - currentCO2;
            const dailyRate = slope;
            const confidence = Math.min(95, 85 + (n * 2)); // Simple confidence calculation

            return {
                forecast,
                currentCO2,
                predictionIn7Days,
                totalChange,
                dailyRate,
                confidence
            };
        }

        /**
         * Generates combined data for chart (historical + predictions)
         */
        function generateChartData() {
            const predictions = calculateCO2Predictions();
            const chartData = [...historicalCO2Data];

            // Add separator and predictions
            predictions.forecast.forEach(pred => {
                chartData.push({
                    date: pred.date,
                    value: pred.value,
                    isPrediction: true
                });
            });

            return { chartData, predictions };
        }

        /**
         * Updates the prediction comparison cards
         */
        function updatePredictionCards() {
            const { predictions } = generateChartData();

            document.getElementById('comp-current-co2').textContent = 
                `${Math.round(predictions.currentCO2)} ppm`;
            
            document.getElementById('comp-pred-co2').textContent = 
                `${Math.round(predictions.predictionIn7Days)} ppm`;
            
            document.getElementById('comp-rate').textContent = 
                `${predictions.dailyRate.toFixed(2)} ppm/d칤a`;
            
            document.getElementById('comp-confidence').textContent = 
                `${Math.round(predictions.confidence)}%`;
        }

        /**
         * Draws the CO2 prediction chart using Chart.js
         */
        function drawCO2Chart() {
            const { chartData, predictions } = generateChartData();

            const ctx = document.getElementById('co2-prediction-chart').getContext('2d');

            // Separate historical and predicted data
            const historicalLabels = chartData.slice(0, 7).map(d => d.date);
            const historicalValues = chartData.slice(0, 7).map(d => d.value);
            const predictedLabels = chartData.slice(7).map(d => d.date);
            const predictedValues = chartData.slice(7).map(d => d.value);

            // Combine for chart display
            const allLabels = chartData.map(d => d.date);
            const allValues = chartData.map(d => d.value);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allLabels,
                    datasets: [
                        {
                            label: 'Hist칩rico',
                            data: historicalValues.concat(new Array(predictedValues.length).fill(null)),
                            borderColor: '#3498DB',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#16A085',
                            pointBorderColor: '#3498DB',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Predicci칩n',
                            data: new Array(historicalValues.length).fill(null).concat(predictedValues),
                            borderColor: '#FF7043',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: '#FF7043',
                            pointBorderColor: '#FF7043',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ECF0F1',
                                font: { family: "'Montserrat', sans-serif", size: 14, weight: 'bold' }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 400,
                            max: 450,
                            ticks: { color: '#BDC3C7', font: { family: "'Inconsolata', monospace" } },
                            grid: { color: 'rgba(189, 195, 199, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#BDC3C7', font: { family: "'Inconsolata', monospace" } },
                            grid: { color: 'rgba(189, 195, 199, 0.1)' }
                        }
                    }
                }
            });
        }

        // ============================================================================
        // OPEN-METEO WEATHER API
        // ============================================================================

        /**
         * Reverse geocode coordinates into city and state using Open-Meteo Geocoding API.
         */
        async function fetchCityName(lat, lon) {
            try {
                const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?latitude=${lat}&longitude=${lon}&language=es`;
                
                const response = await fetch(geocodingUrl);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const result = data.results[0];
                    const city = result.name || 'Ciudad Desconocida';
                    const state = result.admin1 || '';
                    const country = result.country || '';
                    
                    let cityName = city;
                    if (state) {
                        cityName += `, ${state}`;
                    }
                    if (country) {
                        cityName += ` (${country})`;
                    }
                    
                    updateCityTitle(cityName);
                }
            } catch (error) {
                console.error("Geocoding API call failed:", error);
                updateCityTitle("Zapopan, Jalisco (Mexico)", true);
            }
        }

        /**
         * Updates the UI element with the city name.
         */
        function updateCityTitle(text, isError = false) {
            const cityTitleSpan = document.getElementById('city-title');
            cityTitleSpan.textContent = text;
        }

        /**
         * Fetches weather data from Open-Meteo API for Zapopan, Jalisco
         */
        async function fetchWeatherData() {
            try {
                // Coordinates for Zapopan, Jalisco, Mexico
                const latitude = 20.7129;
                const longitude = -103.3887;

                const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m&timezone=auto`;
                
                const response = await fetch(url);
                const data = await response.json();

                if (data.current) {
                    const temperature = data.current.temperature_2m;
                    const humidity = data.current.relative_humidity_2m;
                    
                    const baseCO2 = 405;
                    const estimatedCO2 = baseCO2 + (temperature * 0.5);
                    
                    updateLocalWeatherData(temperature, estimatedCO2, humidity);
                }
            } catch (error) {
                console.error("Error fetching weather data:", error);
            }
        }

        /**
         * Function to update the LOCAL weather metric columns
         */
        function updateLocalWeatherData(temp, co2, humidity) {
            const localTempElement = document.getElementById('local-temp');
            if (localTempElement) {
                localTempElement.textContent = temp.toFixed(1) + '춿C';
            }

            const localCo2Element = document.getElementById('local-co2');
            if (localCo2Element) {
                localCo2Element.textContent = Math.round(co2) + ' ppm';
            }
            
            const localHumidElement = document.getElementById('local-humidity');
            if (localHumidElement) {
                localHumidElement.textContent = humidity.toFixed(1) + '%';
            }
        }

        // ============================================================================
        // SENSOR DATA DISPLAY
        // ============================================================================

        /**
         * Function to update the sensor data from Raspberry Pi
         */
        function updateSensorData(temp, co2, humidity) {
            const currentTempElement = document.getElementById('current-temp');
            if (currentTempElement) {
                currentTempElement.textContent = temp.toFixed(1) + '춿C';
                currentTempElement.style.color = temp > 25 ? '#FF7043' : 'var(--color-accent-green)';
            }

            const currentCo2Element = document.getElementById('current-co2');
            if (currentCo2Element) {
                currentCo2Element.textContent = Math.round(co2) + ' ppm';
                currentCo2Element.style.color = co2 > 420 ? '#FF7043' : 'var(--color-accent-green)';
            }
            
            const currentHumidElement = document.getElementById('current-humidity');
            if (currentHumidElement) {
                currentHumidElement.textContent = humidity.toFixed(1) + '%';
            }
        }

        /**
         * Function to update the 24h predictions
         */
        function updatePredictionData(predTemp, predCo2, predHumidity) {
            document.getElementById('pred-temp').textContent = (predTemp > 0 ? '+' : '') + predTemp.toFixed(1) + '춿C'; 
            document.getElementById('pred-co2').textContent = Math.round(predCo2) + ' ppm';
            document.getElementById('pred-humidity').textContent = Math.round(predHumidity) + '%';
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        window.addEventListener('load', function() {
            // Get geolocation
            const latitude = 20.7129;
            const longitude = -103.3887;
            fetchCityName(latitude, longitude);
            
            // Fetch external weather data
            fetchWeatherData();
            
            // Display sensor data (Raspberry Pi)
            updateSensorData(sensorData.temperature, sensorData.co2, sensorData.humidity);
            
            // Update 24h predictions
            updatePredictionData(2.5, 438, 62);
            
            // Draw prediction chart
            drawCO2Chart();
            
            // Update comparison cards
            updatePredictionCards();
        });

    </script>

</body>
</html>